{"version":3,"sources":["../node_modules/@arcgis/core/geometry/support/meshUtils/loadGLTFMesh.js"],"names":["G","t","e","r","a","o","I","K","R","s","model","lods","shift","i","Map","u","textures","forEach","set","Q","materials","H","l","P","parts","n","J","vertexAttributes","c","position","f","normal","p","tangent","d","color","g","texCoord0","x","typedBuffer","uv","b","F","transform","components","spatialReference","m","resolveFile","busy","request","responseType","signal","data","attributes","count","writeIndex","B","wrap","Y","parameters","$","tt","opacity","emissiveFactor","colorTexture","textureColor","get","normalTexture","textureNormal","emissiveColor","emissiveTexture","textureEmissive","occlusionTexture","textureOcclusion","alphaMode","X","alphaCutoff","doubleSided","metallic","metallicFactor","roughness","roughnessFactor","metallicRoughnessTexture","textureMetallicRoughness","j","slice","y","L","dstIndex","A","U","_","z","elementCount","T","V","h","k","v","fromTypedArray","typedBufferStride","C","N","w","M","D","O","S","E","W","indices","primitiveType","length","push","faces","material","clone","trustSourceNormals","horizontal","Z","vertical","q"],"mappings":"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","file":"static/js/44.c1b44d3c.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../../Color.js\";import e from\"../../../request.js\";import{unwrap as r,applySome as o,isSome as n}from\"../../../core/maybe.js\";import{a as s}from\"../../../chunks/mat3.js\";import{c as a}from\"../../../chunks/mat3f64.js\";import{f as i}from\"../../../chunks/vec3f64.js\";import{f as u}from\"../../../chunks/vec4f64.js\";import l from\"../MeshComponent.js\";import c from\"../MeshMaterialMetallicRoughness.js\";import f from\"../MeshTexture.js\";import m from\"../MeshVertexAttributes.js\";import{BufferViewVec3f64 as p,BufferViewVec3f as d,BufferViewVec4f as g,BufferViewVec4u8 as x,BufferViewVec2f as b,BufferViewVec4u16 as h,BufferViewVec3u8 as v,BufferViewVec3u16 as w}from\"../buffer/BufferView.js\";import{t as j,a as y,s as C,b as M}from\"../../../chunks/vec32.js\";import{t as A,s as T,a as k}from\"../../../chunks/vec42.js\";import{createBuffer as B}from\"../buffer/utils.js\";import{georeferenceByTransform as F}from\"./georeference.js\";import{DefaultLoadingContext as I}from\"../../../views/3d/glTF/DefaultLoadingContext.js\";import{load as R}from\"../../../views/3d/glTF/loader.js\";import{triangleFanToTriangles as E,triangleStripToTriangles as S,trianglesToTriangles as D}from\"../../../views/3d/glTF/internal/indexUtils.js\";import{generateIndexArray as O}from\"../../../views/3d/webgl-engine/lib/geometryDataUtils.js\";import{COLOR_GAMMA as q}from\"../../../views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA.js\";import{f as L,c as N}from\"../../../chunks/vec33.js\";import{f as U,c as V}from\"../../../chunks/vec43.js\";import{n as _,f as z}from\"../../../chunks/vec22.js\";async function G(t,e,r){const o=new I(K(r)),s=(await R(o,e,r,!0)).model,a=s.lods.shift(),i=new Map,u=new Map;s.textures.forEach(((t,e)=>i.set(e,Q(t)))),s.materials.forEach(((t,e)=>u.set(e,H(t,i))));const l=P(a);for(const n of a.parts)J(l,n,u);const{position:c,normal:f,tangent:p,color:d,texCoord0:g}=l.vertexAttributes,x={position:c.typedBuffer,normal:n(f)?f.typedBuffer:null,tangent:n(p)?p.typedBuffer:null,uv:n(g)?g.typedBuffer:null,color:n(d)?d.typedBuffer:null},b=F(x,t,r);return{transform:b.transform,components:l.components,spatialReference:t.spatialReference,vertexAttributes:new m({position:b.vertexAttributes.position,normal:b.vertexAttributes.normal,tangent:b.vertexAttributes.tangent,color:x.color,uv:x.uv})}}function K(t){return null!=t&&t.resolveFile?{busy:!1,request:async(r,o,s)=>{const a=t.resolveFile(r),i=\"image\"===o?\"image\":\"binary\"===o?\"array-buffer\":\"json\";return(await e(a,{responseType:i,signal:n(s)?s.signal:null})).data}}:null}function P(t){let e=0;const r={color:!1,tangent:!1,normal:!1,texCoord0:!1};for(const{attributes:{position:o,normal:n,color:s,tangent:a,texCoord0:i}}of t.parts)e+=o.count,n&&(r.normal=!0),s&&(r.color=!0),a&&(r.tangent=!0),i&&(r.texCoord0=!0);return{writeIndex:0,vertexAttributes:{position:B(p,e),normal:r.normal?B(d,e):null,tangent:r.tangent?B(g,e):null,color:r.color?B(x,e):null,texCoord0:r.texCoord0?B(b,e):null},components:[]}}function Q(t){return new f({data:t.data,wrap:Y(t.parameters.wrap)})}function H(e,n){const s=new t(tt(e.color,e.opacity)),a=e.emissiveFactor?new t(et(e.emissiveFactor)):null;return new c({color:s,colorTexture:r(o(e.textureColor,(t=>n.get(t)))),normalTexture:r(o(e.textureNormal,(t=>n.get(t)))),emissiveColor:a,emissiveTexture:r(o(e.textureEmissive,(t=>n.get(t)))),occlusionTexture:r(o(e.textureOcclusion,(t=>n.get(t)))),alphaMode:X(e.alphaMode),alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,metallic:e.metallicFactor,roughness:e.roughnessFactor,metallicRoughnessTexture:r(o(e.textureMetallicRoughness,(t=>n.get(t))))})}function J(t,e,r){const{position:o,normal:i,tangent:u,color:c,texCoord0:f}=t.vertexAttributes,m=t.writeIndex,p=e.attributes.position.count;if(j(o.slice(m,p),e.attributes.position,e.transform),n(e.attributes.normal)&&n(i)){const t=s(a(),e.transform);y(i.slice(m,p),e.attributes.normal,t)}else n(i)&&L(i,0,0,1,{dstIndex:m,count:p});if(n(e.attributes.tangent)&&n(u)){const t=s(a(),e.transform);A(u.slice(m,p),e.attributes.tangent,t)}else n(u)&&U(u,0,0,1,1,{dstIndex:m,count:p});if(n(e.attributes.texCoord0)&&n(f)?_(f.slice(m,p),e.attributes.texCoord0):n(f)&&z(f,0,0,{dstIndex:m,count:p}),n(e.attributes.color)&&n(c)){const t=e.attributes.color,r=c.slice(m,p);if(4===t.elementCount)t instanceof g?T(r,t,255):t instanceof x?V(r,t):t instanceof h&&k(r,t,8);else{U(r,255,255,255,255);const e=v.fromTypedArray(r.typedBuffer,r.typedBufferStride);t instanceof d?C(e,t,255):t instanceof v?N(e,t):t instanceof w&&M(e,t,8)}}else n(c)&&U(c.slice(m,p),255,255,255,255);const b=W(e.indices||p,e.primitiveType);if(m)for(let n=0;n<b.length;n++)b[n]+=m;t.components.push(new l({faces:b,material:r.get(e.material).clone(),trustSourceNormals:!0})),t.writeIndex+=p}function W(t,e){switch(e){case 4:return D(t,O);case 5:return S(t);case 6:return E(t)}}function X(t){switch(t){case\"OPAQUE\":return\"opaque\";case\"MASK\":return\"mask\";case\"BLEND\":return\"blend\"}}function Y(t){return{horizontal:Z(t.s),vertical:Z(t.t)}}function Z(t){switch(t){case 33071:return\"clamp\";case 33648:return\"mirror\";case 10497:return\"repeat\"}}function $(t){return t**(1/q)*255}function tt(t,e){return u($(t[0]),$(t[1]),$(t[2]),e)}function et(t){return i($(t[0]),$(t[1]),$(t[2]))}export{G as loadGLTFMesh};\n"],"sourceRoot":""}